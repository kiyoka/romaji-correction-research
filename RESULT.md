# ローマ字タイプミス自動修正実験 結果

## 実験概要

**実験日時**: 2024-12-14 14:33:58

**使用モデル**: GPT-5.2
**API**: OpenAI Responses API
**設定**: reasoning.effort = "low", reasoning.summary = "concise"

## 総合結果

| 指標 | 値 |
|------|------|
| 総テストケース数 | 18件 |
| 完全一致率 | **72.22% (13/18)** |
| 平均編集距離 | 1.00 |
| 平均応答時間 | 2.58秒 |

## データセット別結果

### 実データ（Real Data）

| # | タイプミス | 期待結果 | LLM出力 | カテゴリ | 結果 | 編集距離 | 応答時間(秒) |
|---|------------|----------|---------|----------|------|----------|--------------|
| 1 | kanselshimazu | キャンセルします | かんせいしまづ | substitution+deletion | ✗ | 6 | 8.72 |
| 2 | sousimazu | そうします | そうします | substitution | ✓ | 0 | 1.56 |
| 3 | roukaidesu | 了解です | 廊下です | deletion | ✗ | 2 | 2.23 |
| 4 | okdesu | OKです | OKです | omission | ✓ | 0 | 2.21 |
| 5 | daijyobudesu | 大丈夫です | だいじょうぶです | deletion | ✗ | 6 | 0.94 |
| 6 | gwnnki | 元気 | ぐんき | substitution | ✗ | 3 | 3.18 |
| 7 | mattetekudadai | 待っててください | 待っててください | substitution | ✓ | 0 | 1.86 |
| 8 | shinkanswn | 新幹線 | 新幹線 | substitution | ✓ | 0 | 4.06 |

**実データの正解率: 50.0% (4/8)**

### 仮想データ（Virtual Data）

| # | タイプミス | 期待結果 | LLM出力 | カテゴリ | 結果 | 編集距離 | 応答時間(秒) |
|---|------------|----------|---------|----------|------|----------|--------------|
| 1 | srigatou | ありがとう | ありがとう | substitution | ✓ | 0 | 1.37 |
| 2 | arigatoi | ありがとう | ありがとう | substitution | ✓ | 0 | 4.40 |
| 3 | kawsii | かわいい | かわいい | substitution | ✓ | 0 | 2.15 |
| 4 | onegiashimasu | お願いします | お願いします | transposition | ✓ | 0 | 1.86 |
| 5 | konichiwa | こんにちは | こんにちは | deletion | ✓ | 0 | 0.70 |
| 6 | arigatouu | ありがとう | ありがとう | insertion | ✓ | 0 | 1.65 |
| 7 | konniciha | こんにちは | こんにちは | transposition | ✓ | 0 | 2.73 |
| 8 | srigtou | ありがとう | ありがとう | complex | ✓ | 0 | 3.07 |
| 9 | tanoshu | たのしい | たのしゅ | substitution | ✗ | 1 | 2.02 |
| 10 | gwnki | げんき | げんき | substitution | ✓ | 0 | 1.67 |

**仮想データの正解率: 90.0% (9/10)**

## 失敗ケースの詳細分析

### 実データの失敗（4件）

1. **kanselshimazu → かんせいしまづ** (期待: キャンセルします)
   - 音が近い別の読みに変換
   - 平仮名のみで出力（漢字化されず）
   - 編集距離: 6

2. **roukaidesu → 廊下です** (期待: 了解です)
   - 同音異義語の誤変換
   - 編集距離: 2

3. **daijyobudesu → だいじょうぶです** (期待: 大丈夫です)
   - 平仮名表記（漢字が期待値）
   - 編集距離: 6

4. **gwnnki → ぐんき** (期待: 元気)
   - 音が近い別の読みに変換
   - 平仮名のみで出力
   - 編集距離: 3

### 仮想データの失敗（1件）

1. **tanoshu → たのしゅ** (期待: たのしい)
   - 語尾の誤変換（u→ゅ）
   - 編集距離: 1

## 成功パターン

1. **単純な文字置換**: `srigatou → ありがとう`、`kawsii → かわいい`
2. **文字の挿入/削除**: `konichiwa → こんにちは`、`arigatouu → ありがとう`
3. **文字順序の入れ替え**: `konniciha → こんにちは`、`onegiashimasu → お願いします`
4. **複合エラー**: `srigtou → ありがとう` (a→s + a脱落)
5. **複雑なパターン**: `mattetekudadai → 待っててください`

## 主な課題

### 1. 平仮名・漢字の表記制御

変換は成功するが、適切な漢字表記にならないケースがある：
- `daijyobudesu → だいじょうぶです`（期待: 大丈夫です）
- `gwnnki → ぐんき`（期待: 元気）
- `kanselshimazu → かんせいしまづ`（期待: キャンセルします）

### 2. 同音異義語の誤変換

文脈がないと正しい変換が困難：
- `roukaidesu → 廊下です`（期待: 了解です）

### 3. 応答時間

2.58秒の平均応答時間は、IMEのリアルタイム入力には遅い。
- 目標: 0.3秒以下
- 現状: 2.58秒（約8倍遅い）

## 結論

### 達成できたこと

1. **高い変換精度**: 72.22%の正解率を達成
2. **複雑なエラーへの対応**: 複合エラー（複数の誤入力が組み合わさったケース）も正しく修正可能
3. **仮想データで90%の精度**: 単純なタイプミスは高確率で修正可能

### IME用途への適用可能性

**現状の評価**:
- 精度面では有望（72.22%）だが、IME用途としては以下の課題がある

**主な課題**:
1. 応答時間が遅い（2.58秒 vs 目標0.3秒）
2. 漢字変換の制御が不完全
3. 同音異義語の処理に文脈が必要

### 改善提案

1. **応答時間の短縮**:
   - `reasoning.effort` を "none" または "minimal" に変更
   - より高速なモデルの検討

2. **漢字変換の改善**:
   - プロンプトに「適切な漢字を使用してください」などの明示的な指示を追加
   - 期待する表記形式の例を提示

3. **文脈情報の活用**:
   - 前後の文脈をプロンプトに含める
   - 会話履歴の活用

4. **ハイブリッドアプローチ**:
   - 従来のIME辞書 + LLMによる補正
   - LLMは複雑なケースのみに使用し、単純なケースは辞書ベースで処理

## 技術詳細

### 使用したAPI

OpenAI Responses API with reasoning:

```python
response = client.responses.create(
    model="gpt-5.2",
    input=[{"role": "user", "content": prompt}],
    reasoning={
        "effort": "low",
        "summary": "concise"
    }
)
```

### プロンプト

```
次のローマ字入力（タイプミスを含む可能性あり）を日本語に変換してください。変換結果のみを返してください。

入力: {typo}
日本語:
```

### 評価指標

1. **完全一致率（Exact Match）**: LLM出力と期待結果が完全に一致した割合
2. **編集距離（Levenshtein Distance）**: LLM出力と期待結果の文字差異
