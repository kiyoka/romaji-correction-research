# ローマ字タイプミス自動修正実験 結果

## 実験概要

**実験日時**: 2025-12-14 15:07:09

**使用モデル**: GPT-5.2
**API**: OpenAI Responses API
**設定**: reasoning.effort = "low", reasoning.summary = "concise"
**評価方式**: 複数正解対応（correct1またはcorrect2のいずれかが一致すれば正解）

## 総合結果

| 指標 | 値 |
|------|------|
| 総テストケース数 | 18件 |
| 完全一致率 | **88.89% (16/18)** |
| 平均編集距離 | 0.39 |
| 平均応答時間 | 2.52秒 |

## データセット別結果

### 実データ（Real Data）

| # | タイプミス | 期待結果 | LLM出力 | カテゴリ | 結果 | 編集距離 | 応答時間(秒) |
|---|------------|----------|---------|----------|------|----------|--------------|
| 1 | kanselshimazu | キャンセルします | かんせるしまづ | substitution+deletion | ✗ | 6 | 9.19 |
| 2 | sousimazu | そうします | そうします | substitution | ✓ | 0 | 3.82 |
| 3 | roukaidesu | 了解です / 廊下です | 了解です | deletion | ✓ | 0 | 2.80 |
| 4 | okdesu | OKです / オッケーです | OKです | omission | ✓ | 0 | 1.93 |
| 5 | daijyobudesu | 大丈夫です / だいじょうぶです | だいじょうぶです | deletion | ✓ | 0 | 0.88 |
| 6 | gwnnki | 元気 / げんき | げんき | substitution | ✓ | 0 | 4.61 |
| 7 | mattetekudadai | 待っててください | 待っててください | substitution | ✓ | 0 | 2.02 |
| 8 | shinkanswn | 新幹線 | 新幹線 | substitution | ✓ | 0 | 1.49 |

**実データの正解率: 87.5% (7/8)**

### 仮想データ（Virtual Data）

| # | タイプミス | 期待結果 | LLM出力 | カテゴリ | 結果 | 編集距離 | 応答時間(秒) |
|---|------------|----------|---------|----------|------|----------|--------------|
| 1 | srigatou | 有難う / ありがとう | ありがとう | substitution | ✓ | 0 | 1.27 |
| 2 | arigatoi | 有難う / ありがとう | ありがとう | substitution | ✓ | 0 | 1.11 |
| 3 | kawsii | 可愛い / かわいい | かわいい | substitution | ✓ | 0 | 2.48 |
| 4 | onegiashimasu | お願いします / おねがいします | お願いします | transposition | ✓ | 0 | 1.78 |
| 5 | konichiwa | こんにちは | こんにちは | deletion | ✓ | 0 | 1.74 |
| 6 | arigatouu | 有難う / ありがとう | ありがとう | insertion | ✓ | 0 | 1.36 |
| 7 | konniciha | こんにちは | こんにちは | transposition | ✓ | 0 | 0.90 |
| 8 | srigtou | 有難う / ありがとう | ありがとう | complex | ✓ | 0 | 3.14 |
| 9 | tanoshu | 楽しい / たのしい | たのしゅ | substitution | ✗ | 1 | 3.20 |
| 10 | gwnki | 元気 / げんき | げんき | substitution | ✓ | 0 | 1.55 |

**仮想データの正解率: 90.0% (9/10)**

## 失敗ケースの詳細分析

### 実データの失敗（1件）

1. **kanselshimazu → かんせるしまづ** (期待: キャンセルします)
   - 音が近い別の読みに変換
   - 平仮名のみで出力（漢字化されず）
   - 編集距離: 6

### 仮想データの失敗（1件）

1. **tanoshu → たのしゅ** (期待: たのしい)
   - 語尾の誤変換（u→ゅ）
   - 編集距離: 1

### 複数正解対応により改善されたケース（3件）

以下のケースは、複数正解システムにより **不正解から正解に改善** されました：

1. **roukaidesu → 了解です** ✓
   - LLM出力: 了解です
   - 正解候補: 了解です / 廊下です
   - 以前の評価: ✗ (廊下です と出力した場合)
   - 新評価: ✓ (どちらも正解として認める)

2. **daijyobudesu → だいじょうぶです** ✓
   - LLM出力: だいじょうぶです
   - 正解候補: 大丈夫です / だいじょうぶです
   - 以前の評価: ✗ (平仮名表記のため)
   - 新評価: ✓ (平仮名表記も正解として認める)

3. **gwnnki → げんき** ✓
   - LLM出力: げんき
   - 正解候補: 元気 / げんき
   - 以前の評価: ✗ (平仮名表記のため)
   - 新評価: ✓ (平仮名表記も正解として認める)

## 成功パターン

1. **単純な文字置換**: `srigatou → ありがとう`、`kawsii → かわいい`
2. **文字の挿入/削除**: `konichiwa → こんにちは`、`arigatouu → ありがとう`
3. **文字順序の入れ替え**: `konniciha → こんにちは`、`onegiashimasu → お願いします`
4. **複合エラー**: `srigtou → ありがとう` (a→s + a脱落)
5. **複雑なパターン**: `mattetekudadai → 待っててください`

## 主な課題

### 1. 複雑なタイプミスの変換精度

音が大きく変わる複雑なタイプミスは依然として困難：
- `kanselshimazu → かんせるしまづ`（期待: キャンセルします）
  - 複合エラー（s→z, y抜け）により音が変化
  - 編集距離: 6

### 2. 語尾の微妙な変換

小さな変換ミスが残る：
- `tanoshu → たのしゅ`（期待: たのしい）
  - 語尾の誤変換（u→ゅ）
  - 編集距離: 1

### 3. 応答時間

2.52秒の平均応答時間は、IMEのリアルタイム入力には遅い。
- 目標: 0.3秒以下
- 現状: 2.52秒（約8倍遅い）

## 結論

### 達成できたこと

1. **非常に高い変換精度**: **88.89%の正解率を達成**
   - 複数正解対応により、72.22%から16.67ポイント向上
   - 実データ: 50.0% → 87.5% (37.5ポイント向上)
   - 仮想データ: 90.0% (変わらず)

2. **複雑なエラーへの対応**: 複合エラー（複数の誤入力が組み合わさったケース）も正しく修正可能
   - `srigtou → ありがとう` (a→s + a脱落)
   - `onegiashimasu → お願いします` (文字順入れ替え)

3. **表記ゆれへの対応**: 漢字・平仮名の両方を正解として受け入れることで実用性が向上
   - `daijyobudesu → だいじょうぶです` ✓ (大丈夫です / だいじょうぶです)
   - `gwnnki → げんき` ✓ (元気 / げんき)

### IME用途への適用可能性

**現状の評価**:
- **精度面では非常に有望（88.89%）**、ほとんどのタイプミスを正しく修正可能

**主な課題**:
1. **応答時間が遅い**（2.52秒 vs 目標0.3秒）
   - IMEのリアルタイム入力には約8倍遅い
   - reasoning.effort の調整または高速モデルの検討が必要

### 改善提案

1. **応答時間の短縮（最優先課題）**:
   - `reasoning.effort` を "none" または "minimal" に変更
   - より高速なモデル（GPT-4o-mini等）の検討
   - バッチ処理やキャッシング機構の導入

2. **残り2件の失敗ケースへの対応**:
   - 複雑な複合エラー（`kanselshimazu`）への対策
     - Few-shot例の追加
     - より詳細なプロンプト
   - 語尾の微妙な変換ミス（`tanoshu`）への対策
     - 日本語の語尾パターンの学習強化

3. **文脈情報の活用**:
   - 前後の文脈をプロンプトに含める
   - 会話履歴の活用

4. **ハイブリッドアプローチ**:
   - 従来のIME辞書 + LLMによる補正
   - LLMは複雑なケースのみに使用し、単純なケースは辞書ベースで処理
   - 応答時間を大幅に短縮可能

## 技術詳細

### 使用したAPI

OpenAI Responses API with reasoning:

```python
response = client.responses.create(
    model="gpt-5.2",
    input=[{"role": "user", "content": prompt}],
    reasoning={
        "effort": "low",
        "summary": "concise"
    }
)
```

### プロンプト

```
次のローマ字入力（タイプミスを含む可能性あり）を日本語に変換してください。変換結果のみを返してください。

入力: {typo}
日本語:
```

### 評価指標

1. **完全一致率（Exact Match）**: LLM出力と期待結果（correct1またはcorrect2のいずれか）が完全に一致した割合
   - 複数正解対応: 各テストケースに対してcorrect1とcorrect2の2つの正解候補を設定
   - どちらか一方に一致すれば正解と判定
2. **編集距離（Levenshtein Distance）**: LLM出力と最も近い期待結果（correct1とcorrect2のうち距離が小さい方）との文字差異
